<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test API Games</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #0f1419;
            color: #e8eaed;
        }
        h1 {
            color: #6c63ff;
            border-bottom: 3px solid #6c63ff;
            padding-bottom: 10px;
        }
        .section {
            background: #1b1f3b;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
        }
        .game-card {
            background: #252a47;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
            border-left: 4px solid #6c63ff;
        }
        .game-card h3 {
            margin: 0 0 10px 0;
            color: #6c63ff;
        }
        .badge {
            display: inline-block;
            padding: 4px 8px;
            margin: 4px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
        }
        .badge-type { background: #4caf50; color: white; }
        .badge-difficulty { background: #ff9800; color: white; }
        .badge-category { background: #2196f3; color: white; }
        .badge-enabled { background: #8bc34a; color: white; }
        .badge-disabled { background: #f44336; color: white; }
        button {
            background: #6c63ff;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
        }
        button:hover {
            background: #5a52d5;
        }
        #results {
            white-space: pre-wrap;
            background: #0a0e27;
            padding: 15px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            overflow-x: auto;
        }
        .success { color: #4caf50; }
        .error { color: #f44336; }
        .info { color: #2196f3; }
    </style>
</head>
<body>
    <h1>üéÆ Test API Games - Diagnostic</h1>
    
    <div class="section">
        <h2>üîç Tests disponibles</h2>
        <button onclick="testGetAllGames()">üìã GET /api/games</button>
        <button onclick="testGetGameById('math-quiz-1')">üéØ GET /api/games/math-quiz-1</button>
        <button onclick="testGetGameById('cs-quiz-1')">üíª GET /api/games/cs-quiz-1</button>
        <button onclick="compareWithLocalStorage()">üîÑ Comparer avec localStorage</button>
        <button onclick="clearResults()">üßπ Clear</button>
    </div>
    
    <div class="section">
        <h2>üìä R√©sultats</h2>
        <div id="results">Cliquez sur un bouton pour tester l'API...</div>
    </div>
    
    <div class="section" id="gamesDisplay" style="display: none;">
        <h2>üéÆ Jeux charg√©s</h2>
        <div id="gamesList"></div>
    </div>

    <script>
        const API_URL = 'http://localhost:5000/api';
        
        function log(message, type = 'info') {
            const results = document.getElementById('results');
            const timestamp = new Date().toLocaleTimeString();
            const color = type === 'success' ? 'success' : type === 'error' ? 'error' : 'info';
            results.innerHTML += `<span class="${color}">[${timestamp}] ${message}</span>\n`;
        }
        
        function clearResults() {
            document.getElementById('results').innerHTML = 'R√©sultats effac√©s...\n';
            document.getElementById('gamesDisplay').style.display = 'none';
        }
        
        async function testGetAllGames() {
            clearResults();
            log('üîÑ Testing GET /api/games...', 'info');
            
            try {
                const response = await fetch(`${API_URL}/games`);
                const data = await response.json();
                
                if (response.ok && data.success) {
                    log(`‚úÖ SUCCESS! Received ${data.count} games`, 'success');
                    log(JSON.stringify(data, null, 2), 'info');
                    
                    // Afficher les jeux
                    displayGames(data.data);
                } else {
                    log(`‚ùå ERROR: ${data.message || 'Unknown error'}`, 'error');
                }
            } catch (error) {
                log(`‚ùå FETCH ERROR: ${error.message}`, 'error');
                log('üí° Assurez-vous que le backend tourne sur http://localhost:5000', 'info');
            }
        }
        
        async function testGetGameById(gameId) {
            clearResults();
            log(`üîÑ Testing GET /api/games/${gameId}...`, 'info');
            
            try {
                const response = await fetch(`${API_URL}/games/${gameId}`);
                const data = await response.json();
                
                if (response.ok && data.success) {
                    log(`‚úÖ SUCCESS! Game found: ${data.data.title}`, 'success');
                    log(JSON.stringify(data, null, 2), 'info');
                    
                    // Afficher le jeu
                    displayGames([data.data]);
                } else {
                    log(`‚ùå ERROR: ${data.message || 'Game not found'}`, 'error');
                }
            } catch (error) {
                log(`‚ùå FETCH ERROR: ${error.message}`, 'error');
            }
        }
        
        function displayGames(games) {
            const gamesDisplay = document.getElementById('gamesDisplay');
            const gamesList = document.getElementById('gamesList');
            
            gamesDisplay.style.display = 'block';
            gamesList.innerHTML = '';
            
            games.forEach(game => {
                const card = document.createElement('div');
                card.className = 'game-card';
                card.innerHTML = `
                    <h3>${game.icon || 'üéÆ'} ${game.title}</h3>
                    <p><strong>Description:</strong> ${game.description || 'N/A'}</p>
                    <div>
                        <span class="badge badge-type">${game.type}</span>
                        <span class="badge badge-difficulty">${game.difficulty}</span>
                        <span class="badge badge-category">${game.category}</span>
                        <span class="badge ${game.isEnabled ? 'badge-enabled' : 'badge-disabled'}">
                            ${game.isEnabled ? 'Enabled' : 'Disabled'}
                        </span>
                    </div>
                    <p><strong>GameID:</strong> ${game.gameId} | <strong>Time:</strong> ${game.timeLimit}s | <strong>Levels:</strong> ${game.levels?.length || 0}</p>
                    ${game.levels && game.levels.length > 0 ? `
                        <p><strong>Level 1 Questions:</strong> ${game.levels[0].questions?.length || 0}</p>
                    ` : ''}
                `;
                gamesList.appendChild(card);
            });
        }
        
        function compareWithLocalStorage() {
            clearResults();
            log('üîÑ Comparing API with localStorage...', 'info');
            
            // V√©rifier localStorage
            const customGames = localStorage.getItem('customGames');
            const availableGames = localStorage.getItem('AVAILABLE_GAMES');
            
            log(`\nüì¶ localStorage content:`, 'info');
            
            if (customGames) {
                const parsed = JSON.parse(customGames);
                log(`  customGames: ${parsed.length} games found`, 'info');
                log(JSON.stringify(parsed, null, 2), 'info');
            } else {
                log(`  customGames: NOT FOUND`, 'error');
            }
            
            if (availableGames) {
                const parsed = JSON.parse(availableGames);
                log(`\n  AVAILABLE_GAMES: ${parsed.length} games found`, 'info');
            } else {
                log(`  AVAILABLE_GAMES: NOT FOUND`, 'error');
            }
            
            // Tester l'API
            fetch(`${API_URL}/games`)
                .then(r => r.json())
                .then(data => {
                    log(`\nüåê API Response:`, 'info');
                    log(`  ${data.count} games from database`, 'success');
                    
                    // Comparer
                    const customCount = customGames ? JSON.parse(customGames).length : 0;
                    const apiCount = data.count;
                    
                    log(`\nüìä Comparison:`, 'info');
                    log(`  localStorage customGames: ${customCount}`, 'info');
                    log(`  API games (database): ${apiCount}`, 'info');
                    
                    if (apiCount > 0 && customCount === 0) {
                        log(`\nüí° DIAGNOSTIC: Les jeux sont en base de donn√©es mais pas dans localStorage!`, 'success');
                        log(`   La page Single.jsx devrait charger depuis l'API maintenant.`, 'success');
                    } else if (customCount > 0) {
                        log(`\n‚ö†Ô∏è  ATTENTION: ${customCount} jeux dans localStorage (jeux cr√©√©s)`, 'error');
                        log(`   Ces jeux ne sont PAS dans la base de donn√©es!`, 'error');
                    }
                })
                .catch(err => {
                    log(`\n‚ùå API ERROR: ${err.message}`, 'error');
                });
        }
        
        // Auto-test au chargement
        window.onload = () => {
            log('üöÄ Page de diagnostic charg√©e', 'success');
            log('üí° Cliquez sur les boutons pour tester l\'API\n', 'info');
        };
    </script>
</body>
</html>
